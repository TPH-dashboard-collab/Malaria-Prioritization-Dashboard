writeLines(
## ---- app/ui.R ---------------------------------------------
writeLines(
'# ============================================================
#  app/ui.R
# ============================================================
library(shiny)
library(leaflet)
library(plotly)
ui <- fluidPage(
titlePanel("Malaria Prioritization Dashboard"),
sidebarLayout(
sidebarPanel(
selectInput("region",  "RegiÃ£o",   choices = NULL),
selectInput("interv",  "IntervenÃ§Ã£o", choices = NULL),
sliderInput("year",    "Ano",
min = 2015, max = 2025, value = 2022, sep = ""),
actionButton("run",    "Actualizar", class = "btn-primary")
),
mainPanel(
tabsetPanel(
tabPanel("Mapa",      leafletOutput("map",    height = 500)),
tabPanel("Ranking",   plotlyOutput("ranking", height = 450)),
tabPanel("Quantis",   tableOutput("quantile_table")),
tabPanel("Sobre",     includeMarkdown("../README.md"))
)
)
)
)
',
file.path(project_root, "app", "ui.R")
## ---- app/ui.R ---------------------------------------------
writeLines(
project_root <- file.path(getwd(), "MalariaPrioritizationDashboard")
# ---------- 1. Criar pastas ---------------------------------
dirs <- c("data", "app", "data-analysis/outputs", "utils", "additional")
message("\nðŸ“  Criando estrutura em: ", project_root, "\n")
for (d in dirs) {
p <- file.path(project_root, d)
if (!dir.exists(p)) { dir.create(p, recursive = TRUE); message("  âœ…  ", d) }
else                 { message("  âš ï¸   JÃ¡ existe: ", d) }
}
# ---------- 2. FunÃ§Ã£o auxiliar para escrever ficheiros ------
escrever <- function(relpath, texto) {
writeLines(texto, file.path(project_root, relpath))
message("  ðŸ“„  ", relpath)
}
message("\nCriando ficheiros...\n")
# ---------- run_app.R ---------------------------------------
escrever("run_app.R",
'# Ponto de entrada â€“ execute este ficheiro para lanÃ§ar a app
library(shiny)
source("utils/calculate_quantiles.R")
shiny::runApp("app", launch.browser = TRUE)
')
# ---------- app/ui.R ----------------------------------------
escrever("app/ui.R",
'library(shiny)
library(leaflet)
library(plotly)
ui <- fluidPage(
titlePanel("Malaria Prioritization Dashboard"),
sidebarLayout(
sidebarPanel(
selectInput("region", "Regiao",       choices = NULL),
selectInput("interv", "Intervencao",  choices = NULL),
sliderInput("year",   "Ano", min = 2015, max = 2025, value = 2022, sep = ""),
actionButton("run",   "Actualizar", class = "btn-primary")
),
mainPanel(
tabsetPanel(
tabPanel("Mapa",    leafletOutput("map",           height = 500)),
tabPanel("Ranking", plotlyOutput("ranking",        height = 450)),
tabPanel("Quantis", tableOutput("quantile_table"))
)
)
)
)
')
# ---------- app/server.R ------------------------------------
escrever("app/server.R",
'library(shiny)
library(leaflet)
library(plotly)
library(dplyr)
source("../utils/calculate_quantiles.R")
server <- function(input, output, session) {
dados <- reactive({
req(input$run)
readRDS("../data/arquivo_compacto.rds")
})
observe({
d <- dados()
updateSelectInput(session, "region", choices = unique(d$region))
updateSelectInput(session, "interv", choices = unique(d$intervention))
})
dados_filtrados <- reactive({
dados() |>
filter(region       == input$region,
intervention == input$interv,
year         == input$year)
})
output$map <- renderLeaflet({
leaflet() |> addTiles()
})
output$ranking <- renderPlotly({
df <- dados_filtrados()
plot_ly(df, x = ~district, y = ~impact_score, type = "bar")
})
output$quantile_table <- renderTable({
calcular_quantis(dados_filtrados()$impact_score)
})
}
')
# ---------- utils/calculate_quantiles.R ---------------------
escrever("utils/calculate_quantiles.R",
'# Funcoes reutilizaveis de quantis
calcular_quantis <- function(x, probs = c(0, 0.20, 0.40, 0.60, 0.80, 1)) {
stopifnot(is.numeric(x))
q <- quantile(x, probs = probs, na.rm = TRUE)
data.frame(quantil = names(q), valor = round(unname(q), 3))
}
classificar_quintil <- function(x) {
cut(x,
breaks         = quantile(x, probs = seq(0, 1, 0.2), na.rm = TRUE),
labels         = paste0("Q", 1:5),
include.lowest = TRUE)
}
')
# ---------- data-analysis/Christian_code.R ------------------
escrever("data-analysis/Christian_code.R",
'library(dplyr)
library(openxlsx)
source("../utils/calculate_quantiles.R")
dados <- readRDS("../data/arquivo_compacto.rds")
impacto <- dados |>
group_by(region, district, intervention) |>
summarise(
cases_averted  = sum(cases_averted,  na.rm = TRUE),
deaths_averted = sum(deaths_averted, na.rm = TRUE),
impact_score   = sum(impact_score,   na.rm = TRUE),
.groups = "drop"
) |>
group_by(intervention) |>
mutate(
quintil = classificar_quintil(impact_score),
ranking = rank(-impact_score, ties.method = "min")
) |>
ungroup()
quantis  <- calcular_quantis(impacto$impact_score)
rankings <- impacto |> arrange(intervention, ranking)
write.xlsx(impacto,  "outputs/impacts_christian_method.xlsx",   overwrite = TRUE)
write.xlsx(quantis,  "outputs/quantiles_christian_method.xlsx", overwrite = TRUE)
write.xlsx(rankings, "outputs/rankings_christian_method.xlsx",  overwrite = TRUE)
message("Analise concluida. Ficheiros em data-analysis/outputs/")
')
# ---------- additional/check_data_10_regions.R --------------
escrever("additional/check_data_10_regions.R",
'dados <- readRDS("../data/arquivo_compacto.rds")
cat("=== Sumario geral ===\n")
cat("Linhas:", nrow(dados), " | Colunas:", ncol(dados), "\n\n")
cat("=== Regioes presentes ===\n")
print(sort(unique(dados$region)))
cat("\n=== Valores em falta por coluna ===\n")
na_summary <- sapply(dados, function(x) sum(is.na(x)))
print(na_summary[na_summary > 0])
n <- length(unique(dados$region))
if (n == 10) cat("\nOK - 10 regioes encontradas.\n") else
cat("\nATENCAO -", n, "regioes (esperado: 10).\n")
')
# ---------- README.md ---------------------------------------
escrever("README.md",
'# Malaria Prioritization Dashboard
## Estrutura
- data/               -> dados brutos (rds, shp, xlsx)
- app/ui.R            -> interface Shiny
- app/server.R        -> logica do servidor
- data-analysis/      -> analise Christian Method + outputs
- utils/              -> funcoes partilhadas
- additional/         -> validacao de dados
- run_app.R           -> ponto de entrada
## Como usar
1. Copie os dados para data/
2. Abra run_app.R e clique Source
')
# ---------- Sumario -----------------------------------------
message("\n", strrep("=", 50))
message("  Estrutura criada com sucesso!")
message(strrep("=", 50))
message("\nProximo passo:")
message("  1. Copie arquivo_compacto.rds e shapefiles para data/")
message("  2. Abra run_app.R e clique Source\n")
getwd()
project_root <- file.path(getwd(), "MalariaPrioritizationDashboard")
# ---------- 1. Criar pastas ---------------------------------
dirs <- c("data", "app", "data-analysis/outputs", "utils", "additional")
message("\nðŸ“  Criando estrutura em: ", project_root, "\n")
for (d in dirs) {
p <- file.path(project_root, d)
if (!dir.exists(p)) { dir.create(p, recursive = TRUE); message("  âœ…  ", d) }
else                 { message("  âš ï¸   JÃ¡ existe: ", d) }
}
# ---------- 2. FunÃ§Ã£o auxiliar para escrever ficheiros ------
escrever <- function(relpath, texto) {
writeLines(texto, file.path(project_root, relpath))
message("  ðŸ“„  ", relpath)
}
message("\nCriando ficheiros...\n")
# ---------- run_app.R ---------------------------------------
escrever("run_app.R",
'# Ponto de entrada â€“ execute este ficheiro para lanÃ§ar a app
library(shiny)
source("utils/calculate_quantiles.R")
shiny::runApp("app", launch.browser = TRUE)
')
# ---------- app/ui.R ----------------------------------------
escrever("app/ui.R",
'library(shiny)
library(leaflet)
library(plotly)
ui <- fluidPage(
titlePanel("Malaria Prioritization Dashboard"),
sidebarLayout(
sidebarPanel(
selectInput("region", "Regiao",       choices = NULL),
selectInput("interv", "Intervencao",  choices = NULL),
sliderInput("year",   "Ano", min = 2015, max = 2025, value = 2022, sep = ""),
actionButton("run",   "Actualizar", class = "btn-primary")
),
mainPanel(
tabsetPanel(
tabPanel("Mapa",    leafletOutput("map",           height = 500)),
tabPanel("Ranking", plotlyOutput("ranking",        height = 450)),
tabPanel("Quantis", tableOutput("quantile_table"))
)
)
)
)
')
# ---------- app/server.R ------------------------------------
escrever("app/server.R",
'library(shiny)
library(leaflet)
library(plotly)
library(dplyr)
source("../utils/calculate_quantiles.R")
server <- function(input, output, session) {
dados <- reactive({
req(input$run)
readRDS("../data/arquivo_compacto.rds")
})
observe({
d <- dados()
updateSelectInput(session, "region", choices = unique(d$region))
updateSelectInput(session, "interv", choices = unique(d$intervention))
})
dados_filtrados <- reactive({
dados() |>
filter(region       == input$region,
intervention == input$interv,
year         == input$year)
})
output$map <- renderLeaflet({
leaflet() |> addTiles()
})
output$ranking <- renderPlotly({
df <- dados_filtrados()
plot_ly(df, x = ~district, y = ~impact_score, type = "bar")
})
output$quantile_table <- renderTable({
calcular_quantis(dados_filtrados()$impact_score)
})
}
')
# ---------- utils/calculate_quantiles.R ---------------------
escrever("utils/calculate_quantiles.R",
'# Funcoes reutilizaveis de quantis
calcular_quantis <- function(x, probs = c(0, 0.20, 0.40, 0.60, 0.80, 1)) {
stopifnot(is.numeric(x))
q <- quantile(x, probs = probs, na.rm = TRUE)
data.frame(quantil = names(q), valor = round(unname(q), 3))
}
classificar_quintil <- function(x) {
cut(x,
breaks         = quantile(x, probs = seq(0, 1, 0.2), na.rm = TRUE),
labels         = paste0("Q", 1:5),
include.lowest = TRUE)
}
')
# ---------- data-analysis/Christian_code.R ------------------
escrever("data-analysis/Christian_code.R",
'library(dplyr)
library(openxlsx)
source("../utils/calculate_quantiles.R")
dados <- readRDS("../data/arquivo_compacto.rds")
impacto <- dados |>
group_by(region, district, intervention) |>
summarise(
cases_averted  = sum(cases_averted,  na.rm = TRUE),
deaths_averted = sum(deaths_averted, na.rm = TRUE),
impact_score   = sum(impact_score,   na.rm = TRUE),
.groups = "drop"
) |>
group_by(intervention) |>
mutate(
quintil = classificar_quintil(impact_score),
ranking = rank(-impact_score, ties.method = "min")
) |>
ungroup()
quantis  <- calcular_quantis(impacto$impact_score)
rankings <- impacto |> arrange(intervention, ranking)
write.xlsx(impacto,  "outputs/impacts_christian_method.xlsx",   overwrite = TRUE)
write.xlsx(quantis,  "outputs/quantiles_christian_method.xlsx", overwrite = TRUE)
write.xlsx(rankings, "outputs/rankings_christian_method.xlsx",  overwrite = TRUE)
message("Analise concluida. Ficheiros em data-analysis/outputs/")
')
# ---------- additional/check_data_10_regions.R --------------
escrever("additional/check_data_10_regions.R",
'dados <- readRDS("../data/arquivo_compacto.rds")
cat("=== Sumario geral ===\n")
cat("Linhas:", nrow(dados), " | Colunas:", ncol(dados), "\n\n")
cat("=== Regioes presentes ===\n")
print(sort(unique(dados$region)))
cat("\n=== Valores em falta por coluna ===\n")
na_summary <- sapply(dados, function(x) sum(is.na(x)))
print(na_summary[na_summary > 0])
n <- length(unique(dados$region))
if (n == 10) cat("\nOK - 10 regioes encontradas.\n") else
cat("\nATENCAO -", n, "regioes (esperado: 10).\n")
')
# ---------- README.md ---------------------------------------
escrever("README.md",
'# Malaria Prioritization Dashboard
## Estrutura
- data/               -> dados brutos (rds, shp, xlsx)
- app/ui.R            -> interface Shiny
- app/server.R        -> logica do servidor
- data-analysis/      -> analise Christian Method + outputs
- utils/              -> funcoes partilhadas
- additional/         -> validacao de dados
- run_app.R           -> ponto de entrada
## Como usar
1. Copie os dados para data/
2. Abra run_app.R e clique Source
')
# ---------- Sumario -----------------------------------------
message("\n", strrep("=", 50))
message("  Estrutura criada com sucesso!")
message(strrep("=", 50))
message("\nProximo passo:")
message("  1. Copie arquivo_compacto.rds e shapefiles para data/")
message("  2. Abra run_app.R e clique Source\n")
setwd("C:/Users/USER/Desktop/SWISS TPH/Malaria-Prioritization-Dashboard")
project_root <- file.path(getwd(), "MalariaPrioritizationDashboard")
# ---------- 1. Criar pastas ---------------------------------
dirs <- c("data", "app", "data-analysis/outputs", "utils", "additional")
message("\nðŸ“  Criando estrutura em: ", project_root, "\n")
for (d in dirs) {
p <- file.path(project_root, d)
if (!dir.exists(p)) { dir.create(p, recursive = TRUE); message("  âœ…  ", d) }
else                 { message("  âš ï¸   JÃ¡ existe: ", d) }
}
# ---------- 2. FunÃ§Ã£o auxiliar para escrever ficheiros ------
escrever <- function(relpath, texto) {
writeLines(texto, file.path(project_root, relpath))
message("  ðŸ“„  ", relpath)
}
message("\nCriando ficheiros...\n")
# ---------- run_app.R ---------------------------------------
escrever("run_app.R",
'# Ponto de entrada â€“ execute este ficheiro para lanÃ§ar a app
library(shiny)
source("utils/calculate_quantiles.R")
shiny::runApp("app", launch.browser = TRUE)
')
# ---------- app/ui.R ----------------------------------------
escrever("app/ui.R",
'library(shiny)
library(leaflet)
library(plotly)
ui <- fluidPage(
titlePanel("Malaria Prioritization Dashboard"),
sidebarLayout(
sidebarPanel(
selectInput("region", "Regiao",       choices = NULL),
selectInput("interv", "Intervencao",  choices = NULL),
sliderInput("year",   "Ano", min = 2015, max = 2025, value = 2022, sep = ""),
actionButton("run",   "Actualizar", class = "btn-primary")
),
mainPanel(
tabsetPanel(
tabPanel("Mapa",    leafletOutput("map",           height = 500)),
tabPanel("Ranking", plotlyOutput("ranking",        height = 450)),
tabPanel("Quantis", tableOutput("quantile_table"))
)
)
)
)
')
# ---------- app/server.R ------------------------------------
escrever("app/server.R",
'library(shiny)
library(leaflet)
library(plotly)
library(dplyr)
source("../utils/calculate_quantiles.R")
server <- function(input, output, session) {
dados <- reactive({
req(input$run)
readRDS("../data/arquivo_compacto.rds")
})
observe({
d <- dados()
updateSelectInput(session, "region", choices = unique(d$region))
updateSelectInput(session, "interv", choices = unique(d$intervention))
})
dados_filtrados <- reactive({
dados() |>
filter(region       == input$region,
intervention == input$interv,
year         == input$year)
})
output$map <- renderLeaflet({
leaflet() |> addTiles()
})
output$ranking <- renderPlotly({
df <- dados_filtrados()
plot_ly(df, x = ~district, y = ~impact_score, type = "bar")
})
output$quantile_table <- renderTable({
calcular_quantis(dados_filtrados()$impact_score)
})
}
')
# ---------- utils/calculate_quantiles.R ---------------------
escrever("utils/calculate_quantiles.R",
'# Funcoes reutilizaveis de quantis
calcular_quantis <- function(x, probs = c(0, 0.20, 0.40, 0.60, 0.80, 1)) {
stopifnot(is.numeric(x))
q <- quantile(x, probs = probs, na.rm = TRUE)
data.frame(quantil = names(q), valor = round(unname(q), 3))
}
classificar_quintil <- function(x) {
cut(x,
breaks         = quantile(x, probs = seq(0, 1, 0.2), na.rm = TRUE),
labels         = paste0("Q", 1:5),
include.lowest = TRUE)
}
')
# ---------- data-analysis/Christian_code.R ------------------
escrever("data-analysis/Christian_code.R",
'library(dplyr)
library(openxlsx)
source("../utils/calculate_quantiles.R")
dados <- readRDS("../data/arquivo_compacto.rds")
impacto <- dados |>
group_by(region, district, intervention) |>
summarise(
cases_averted  = sum(cases_averted,  na.rm = TRUE),
deaths_averted = sum(deaths_averted, na.rm = TRUE),
impact_score   = sum(impact_score,   na.rm = TRUE),
.groups = "drop"
) |>
group_by(intervention) |>
mutate(
quintil = classificar_quintil(impact_score),
ranking = rank(-impact_score, ties.method = "min")
) |>
ungroup()
quantis  <- calcular_quantis(impacto$impact_score)
rankings <- impacto |> arrange(intervention, ranking)
write.xlsx(impacto,  "outputs/impacts_christian_method.xlsx",   overwrite = TRUE)
write.xlsx(quantis,  "outputs/quantiles_christian_method.xlsx", overwrite = TRUE)
write.xlsx(rankings, "outputs/rankings_christian_method.xlsx",  overwrite = TRUE)
message("Analise concluida. Ficheiros em data-analysis/outputs/")
')
# ---------- additional/check_data_10_regions.R --------------
escrever("additional/check_data_10_regions.R",
'dados <- readRDS("../data/arquivo_compacto.rds")
cat("=== Sumario geral ===\n")
cat("Linhas:", nrow(dados), " | Colunas:", ncol(dados), "\n\n")
cat("=== Regioes presentes ===\n")
print(sort(unique(dados$region)))
cat("\n=== Valores em falta por coluna ===\n")
na_summary <- sapply(dados, function(x) sum(is.na(x)))
print(na_summary[na_summary > 0])
n <- length(unique(dados$region))
if (n == 10) cat("\nOK - 10 regioes encontradas.\n") else
cat("\nATENCAO -", n, "regioes (esperado: 10).\n")
')
# ---------- README.md ---------------------------------------
escrever("README.md",
'# Malaria Prioritization Dashboard
## Estrutura
- data/               -> dados brutos (rds, shp, xlsx)
- app/ui.R            -> interface Shiny
- app/server.R        -> logica do servidor
- data-analysis/      -> analise Christian Method + outputs
- utils/              -> funcoes partilhadas
- additional/         -> validacao de dados
- run_app.R           -> ponto de entrada
## Como usar
1. Copie os dados para data/
2. Abra run_app.R e clique Source
')
# ---------- Sumario -----------------------------------------
message("\n", strrep("=", 50))
message("  Estrutura criada com sucesso!")
message(strrep("=", 50))
message("\nProximo passo:")
message("  1. Copie arquivo_compacto.rds e shapefiles para data/")
message("  2. Abra run_app.R e clique Source\n")
